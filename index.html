<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dinosaur AR Experience</title>
    <!-- Tailwind CSS for basic styling (optional, but good for buttons/messages) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the AR experience */
        body {
            margin: 0;
            overflow: hidden; /* Prevent scrolling */
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        /* The AR scene will take up the full available space */
        a-scene {
            width: 100vw;
            height: 100vh;
            position: absolute; /* Position scene to cover the entire viewport */
            top: 0;
            left: 0;
            z-index: 1; /* Ensure AR scene is behind overlay elements if any */
        }

        /* Overlay for instructions and messages */
        .overlay-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100; /* Ensure overlay is on top */
            text-align: center;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            box-sizing: border-box;
        }

        .message-box {
            background-color: #2d3748;
            padding: 2.5rem; /* Increased padding */
            border-radius: 1rem; /* More rounded corners */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.5);
            max-width: 90%;
            width: 500px;
            animation: fadeIn 1s ease-out;
            border: 2px solid #4a5568;
        }

        .instructions-list {
            list-style: none;
            padding: 0;
            margin: 1.5rem 0 0;
            text-align: left;
        }

        .instructions-list li {
            margin-bottom: 0.75rem;
            display: flex;
            align-items: flex-start;
        }

        .instructions-list li::before {
            content: 'ðŸ‘‰'; /* Unicode right pointer */
            margin-right: 10px;
            font-size: 1.2em;
            line-height: 1;
            padding-top: 2px;
        }

        .status-message {
            margin-top: 1.5rem;
            color: #fca5a5; /* Red-300 for error messages */
            font-weight: bold;
            display: none; /* Hidden by default */
        }

        .start-button {
            background-color: #63b3ed; /* Blue-500 */
            color: #ffffff;
            font-weight: bold;
            padding: 0.75rem 2rem;
            border-radius: 0.75rem; /* Rounded button */
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .start-button:hover {
            background-color: #4299e1; /* Blue-600 */
            transform: translateY(-2px);
        }

        .start-button:active {
            transform: translateY(0);
            box-shadow: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Media queries for responsiveness */
        @media (max-width: 768px) {
            .message-box {
                padding: 1.5rem;
                border-radius: 0.75rem;
            }
            .instructions-list {
                font-size: 0.9em;
            }
            .start-button {
                padding: 0.6rem 1.5rem;
            }
        }
    </style>

    <!-- A-Frame and AR.js Libraries -->
    <!-- A-Frame: The WebVR framework for building 3D/AR experiences -->
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1.5.0/dist/aframe-master.min.js"></script>
    <!-- AR.js: Adds marker-based AR capabilities to A-Frame -->
    <script src="https://raw.githack.com/AR-js-tools/AR.js/master/aframe/build/aframe-ar.js"></script>

    <script>
        let arCameraInitialized = false; // Flag to track if AR.js camera has initialized

        // JavaScript to manage the overlay message and start AR
        document.addEventListener('DOMContentLoaded', () => {
            const overlay = document.getElementById('ar-overlay');
            const startButton = document.getElementById('start-ar-button');
            const statusMessage = document.getElementById('status-message');

            // Hide the overlay and start AR when the button is clicked
            startButton.addEventListener('click', () => {
                overlay.style.display = 'none';
                // AR.js will automatically try to start the camera
                // and detect markers once the scene is visible.

                // Set a timeout to check if the camera initialized
                // This helps in providing feedback if permissions are denied or HTTPS is not used
                setTimeout(() => {
                    if (!arCameraInitialized) {
                        statusMessage.textContent = "Camera not initialized. Please ensure the page is served over HTTPS and you have granted camera permissions.";
                        statusMessage.style.display = 'block'; // Show the message
                        overlay.style.display = 'flex'; // Re-show overlay to display message
                    }
                }, 5000); // Check after 5 seconds
            });
        });

        // Event listener for when AR.js initialization is complete and camera access is granted.
        window.addEventListener('arjs-original-camera-init', function () {
            console.log("AR.js camera initialized!");
            arCameraInitialized = true; // Set flag to true
            const statusMessage = document.getElementById('status-message');
            if (statusMessage) {
                statusMessage.style.display = 'none'; // Hide any previous error messages
            }
        });

        // Handle potential errors (e.g., camera not found, permissions denied)
        // This catches generic errors. More specific AR.js errors might be handled by arjs-original-camera-init
        window.addEventListener('error', function(e) {
            console.error("An error occurred:", e);
            const statusMessage = document.getElementById('status-message');
            if (statusMessage) {
                statusMessage.textContent = `An error occurred: ${e.message || 'Unknown error. Check console for details.'}`;
                statusMessage.style.display = 'block';
                const overlay = document.getElementById('ar-overlay');
                overlay.style.display = 'flex'; // Re-show overlay to display message
            }
        });
    </script>
</head>
<body>
    <!-- The AR overlay for instructions and start button -->
    <div id="ar-overlay" class="overlay-container">
        <div class="message-box">
            <h1 class="text-3xl md:text-4xl font-extrabold mb-4 text-blue-300">Dinosaur AR Experience</h1>
            <p class="text-lg mb-6">Get ready to see a dinosaur in your world!</p>
            <ul class="instructions-list text-left text-base leading-relaxed">
                <li>
                    <p class="mb-0"><strong>IMPORTANT: Serve via HTTPS:</strong> For camera access to work, this page MUST be served over HTTPS (e.g., `https://localhost:8000` or a deployed website). Directly opening `file://` might block camera access.</p>
                </li>
                <li>
                    <p class="mb-0"><strong>Allow Camera Access:</strong> Your browser will ask for camera permission. Please allow it.</p>
                </li>
                <li>
                    <p class="mb-0"><strong>Generate Custom Marker:</strong> The marker image you referenced (`https://raw.githubusercontent.com/sujxxll/ar-welcome/main/pattern-maker.png`) needs to be converted into a `.patt` file.</p>
                </li>
                <li>
                    <p class="mb-0"><strong>Convert & Host:</strong> Search for "AR.js marker generator" online, upload your image, download the `.patt` file, and then host it somewhere publicly accessible online (e.g., GitHub Pages).</p>
                </li>
                <li>
                    <p class="mb-0"><strong>Update Code:</strong> **Replace** the placeholder URL in the `&lt;a-marker&gt;` tag in this code with the actual URL to your hosted `.patt` file.</p>
                </li>
                <li>
                    <p class="mb-0"><strong>Point Camera:</strong> Point your device's camera at your printed custom marker.</p>
                </li>
                <li>
                    <p class="mb-0"><strong>Watch the Magic:</strong> A dinosaur model will appear on the marker!</p>
                </li>
            </ul>
            <p id="status-message" class="status-message"></p> <!-- Dynamic status message for camera issues -->
            <button id="start-ar-button" class="start-button mt-8">Start AR</button>
        </div>
    </div>

    <!-- A-Frame Scene -->
    <!-- The ar-scene component from AR.js configures the camera and marker tracking -->
    <a-scene
        embedded
        arjs='sourceType: webcam; detectionMode: mono; cameraParametersUrl: https://raw.githack.com/AR-js-tools/AR.js/master/aframe/build/camera-parameters/camera_para.dat;'
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true;">

        <!-- AR Marker: This defines the marker that AR.js will look for. -->
        <!-- IMPORTANT: AR.js requires a .patt file, not a .png image directly. -->
        <!-- Use an online AR.js marker generator to convert your image (like the one you provided: -->
        <!-- https://raw.githubusercontent.com/sujxxll/ar-welcome/main/pattern-maker.png) -->
        <!-- into a .patt file. Then, host that .patt file online and provide its URL below. -->
        <a-marker type="pattern" url="YOUR_HOSTED_PATTERN_MARKER_URL_GOES_HERE.patt">
            <!-- This is where your 3D dinosaur model will go. -->
            <!-- Initially, it's a simple box. -->
            <a-box
                position="0 0.5 0"
                scale="0.5 0.5 0.5"
                material="color: #FF00FF; opacity: 0.8;"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 4000; easing: linear;">
            </a-box>
            <!-- You can replace the a-box with a GLTF model like this: -->
            <!--
            <a-entity
                gltf-model="url(path/to/your/dinosaur.gltf)"
                scale="0.01 0.01 0.01"  Adjust scale as needed for your model
                position="0 0 0"       Position relative to the marker
                rotation="-90 0 0">    Often GLTF models need rotation to be upright
            </a-entity>
            -->
        </a-marker>

        <!-- A-Frame Camera: This is the camera that renders your scene. -->
        <!-- It's automatically controlled by AR.js for augmented reality. -->
        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>
